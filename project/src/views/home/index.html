<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>活动测试</title>
    <style>
        .flex{
            display: flex;
            align-items: center;
        }
        .flex_grow_1{
            flex-grow:1;
        }
        body {
            background: #000;
            background:rgba(0,0,0,.8);
            padding:0;
            margin:0;
        }
        html,body{
            height:100%;
        }
        .center_box {
            background: url('img/bg_2.png') 100% 100% no-repeat #FCEADB;
            background-size: 100% 100%;
            min-height: 8rem;
            border-radius: 0.2rem;
            padding: 0.2rem 0 0.8rem;
        }

        .hf_box {
            background: url('img/hf.png') no-repeat;
            background-size: 100%;
            height: 46px;
            text-align: center;
            padding-top: 4px;
            font-size: 17px;
            color: #FCEADB;
        }

        .desc_1 {
            font-size: 16px;
            font-family: Alibaba PuHuiTi;
            font-weight: bold;
            color: rgba(51, 51, 51, 1);
            padding-left: 10px;
            padding-top: 4px;
        }

        .desc_2 {
            padding: 8px 0 8px 10px;
            font-size: 12px;
            font-family: Alibaba PuHuiTi;
            font-weight: 400;
            color: rgba(128, 108, 91, 1);
        }

        .share_box {
            padding: 0 0 10px;
            text-align: center;
            width: 100%;
            font-size: 25px;
            font-family: Alibaba PuHuiTi;
            font-weight: 400;
            color: rgba(254, 254, 254, 1);
        }
    </style>
    <script src="js/jquery-1.11.3.js"></script>
    <script src="js/md5.js"></script>
    <script src="js/html2canvas.js"></script>
    <script>
        //designWidth:设计稿的实际宽度值，需要根据实际设置
        //maxWidth:制作稿的最大宽度值，需要根据实际设置
        //这段js的最后面有两个参数记得要设置，一个为设计稿实际宽度，一个为制作稿最大宽度，例如设计稿为750，最大宽度为750，则为(750,750)
        ;(function(designWidth, maxWidth) {
            var doc = document,
            win = window,
            docEl = doc.documentElement,
            remStyle = document.createElement("style"),
            tid;

            function refreshRem() {
                var width = docEl.getBoundingClientRect().width;
                maxWidth = maxWidth || 540;
                width>maxWidth && (width=maxWidth);
                var rem = width * 100 / designWidth;
                remStyle.innerHTML = 'html{font-size:' + rem + 'px;}';
            }

            if (docEl.firstElementChild) {
                docEl.firstElementChild.appendChild(remStyle);
            } else {
                var wrap = doc.createElement("div");
                wrap.appendChild(remStyle);
                doc.write(wrap.innerHTML);
                wrap = null;
            }
            //要等 wiewport 设置好后才能执行 refreshRem，不然 refreshRem 会执行2次；
            refreshRem();

            win.addEventListener("resize", function() {
                clearTimeout(tid); //防止执行两次
                tid = setTimeout(refreshRem, 300);
            }, false);

            win.addEventListener("pageshow", function(e) {
                if (e.persisted) { // 浏览器后退的时候重新计算
                    clearTimeout(tid);
                    tid = setTimeout(refreshRem, 300);
                }
            }, false);

            if (doc.readyState === "complete") {
                doc.body.style.fontSize = "16px";
            } else {
                doc.addEventListener("DOMContentLoaded", function(e) {
                    doc.body.style.fontSize = "16px";
                }, false);
            }
        })(750, 750);
    </script>
</head>
<body>
    <div style="box-sizing:border-box;height:100%;" id="login">
        <div class="black_box">
            <div style="box-sizing:border-box;padding:19px 20px 10px;">
                <div class="center_box">
                <div class="flex">
                    <div style="padding:28px 28px 8px;">
                        <img id="head_img" src="img/user.png" style="width:64px;border-radius:50%;" alt />
                        <div style="text-align:center;"><b id="nickname" style="font-size:14px;"></b></div>
                    </div>
                    <div
                    class="flex_grow_1"
                    style="text-align:right;padding-right:21px;"
                    >
                    <img src="img/2020.png" style="width:162px;" alt />
                    </div>
                </div>
    
                <div style="padding:0 20px;font-size:0;">
                    <img src="img/xian.png" alt style="width:100%;" />
                </div>
                <div class="flex" style="padding:0 5px;">
                    <img src="img/bp_l.png" alt style="width:50px" />
                    <div class="flex_grow_1 hf_box">
                    <!-- <img src="~@/assets/img/hf.png" style="width:100%;" /> -->
                    ￥<span id="money">00</span>
                    </div>
                    <img src="img/bp_r.png" alt style="width:50px" />
                </div>
    
                <div
                    style="color:#FFAB27;text-align:center;position:relative;top:-20px;"
                >
                    <span id="money_wan" style="font-size: 80px;font-weight:bold;">0</span>
                    <span style="font-size:39px;">万</span>
                </div>
                <div style="padding: 0 20px 0;">
                    <img src="img/xian.png" alt style="width:100%;" />
                </div>
                <div class="flex">
                    <div class="flex_grow_1" style="padding-left:15px;">
                    <div class="desc_1">长按识别右边二维码</div>
                    <div class="desc_2">看看你2020年能赚多少钱</div>
                    <img src="img/bp.png" style="width:169px;" alt />
                    </div>
                    <div style="padding-right:26px;">
                    <img id="barcode" src="img/waleqrcode.png" style="width:75px;" alt />
                    </div>
                </div>
                </div>
            </div>
    
            <!-- <img v-if="!no_img" :src="dataURL" alt="" style="width:100%;" /> -->
            <div class="share_box" >
                长按图片保存后，可分享
            </div>
        </div>
        
    </div>

    
    <script>
        $(function(){
            let device ;
            let u = navigator.userAgent, app = navigator.appVersion;
            let isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
            let isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
            if (isAndroid) {
                device = 0
            }
            if (isIOS) {
                device = 1
            }
            var search = location.search;
            var arr = search.slice(1).split('&');
            var arr2 = [];
            for(var i=0;i<arr.length;i++){
                var o = arr[i];
                var c = o.indexOf('=')
                if(c>0){
                    arr2[o.slice(0,c)] = o.slice(c+1)
                }
            }
            if(arr2['code']){
                let now = new Date();
                let md5_data = md5('token=' + now.getTime() + '&key=lldu43d98382');
                $.ajax({
                    url:'getranddata.php',
                    type:'POST',
                    data:{
                        code:arr2['code'],
                        device:device,
                        pid:arr2['state'],
                        token:now.getTime(),
                        data:md5_data
                    },
                    success:function(json){
                        var data = JSON.parse(json)
                        if(data.message){
                            alert(data.message);
                            return;
                        }
                        if(data.errorcode == 0){
                            $('#head_img').attr('src',data.headimgurl);
                            $('#nickname').html(data.username);
                            $('#money').html(data.money);
                            $('#money_wan').html(data.money_wan);
                            $('#barcode').attr('src',data.barcode);
                        }
                        setTimeout(() => {
                            html2canvas(document.querySelector("body"),{ background:'#000'}).then(canvas => {
                                $('body').html('<img src="'+canvas.toDataURL("image/png")+'" style="width:100%;">')
                                alert(3)
                            });
                        }, 500);
                        
                    }
                })
            }
        })
        
        
        
        
    </script>
</body>
</html>